* Building from git repo

After downloading need to re-run the setup to download electron etc.

lein descjop-init
lein descjop-externs

The second one of these will fail when there are any events or subscriptions that have names starting with a double colon. At the moment, these are the ones:

| anh-front.core  | ::events/initialize-db  |
| anh-front.views | ::subs/name             |
|                 | ::subs/projects         |

Removing one of the colons, running lein descjop-externs and then replacing the colons works.

lein-externs has an issue and a pull request to fix this, but no response. There is a fork of lein-externs that has the fix, which I have cloned and linked in checkouts. Not yet tested [2018-05-31 Thu]

see https://github.com/rasom/lein-externs

* Debugging assistants
** re-frisk
NOTE Using this stops the re-frame template from running, ie lein new re-frame throws an error.

This seems to work. Added [lein-re-frisk "0.5.5"] to ~/.lein/profiles.clj in the :user :plugins section.
Added [re-frisk-remote.core] to the requires in anh-front.core, and called (enable-re-frisk-remote!) in init! as below:
#+BEGIN_SRC clojure
(ns anh-front.core
  (:require  [reagent.core :as reagent :refer [atom]]
             [re-frame.core :as re-frame]
             [anh-front.events :as events]
             [anh-front.views :as views]
             [anh-front.config :as config]
             [re-frisk-remote.core :refer [enable-re-frisk-remote!]]))

(defn mount-root [setting]
  (re-frame/clear-subscription-cache!)
  (reagent/render [views/main-panel]
                  (.getElementById js/document "app")))

(defn init! [setting]
  (re-frame/dispatch-sync [::events/initialize-db])
  (enable-re-frisk-remote!)
  (mount-root setting))
#+END_SRC
Then run the re-frisk server with lein re-frisk and the electron executable and go to localhost:4567 to see the re-frisk data. The server doesn't seem to like being run in the background which is a pain in the arse, but workable.

** js console
Nice and easy access to the re-frame database using this command:
#+BEGIN_SRC javascript
window.re_frame.db.app_db.state
#+END_SRC
** in repl
re-frame.db/app-db shows the contents of db, but also gives an error message.?!? Plus emacs doesn't like the volume of data, and the error means it can't be dereferenced and filtered to limit the amount of data returned. re-frame-demo project doesn't suffer from this. Reverting re-frame to version "0.10.4" fixed this. But only temporarily. What seems to work is changing the version, re-running lein descjop-externs and restarting the repls. Haha. That was because the repl and the browser are seeing different things. Edit a file and save it and the error goes away.
** re-frame-10x
Works fine when included from the re-frame template but not so easy to add by hand.

Using master branch from commit a52a0d1e83b278fd2129948c7334d9b8b3e33581 I get these warnings when running the cljsbuild:
#+BEGIN_SRC shell
(master) working: lein rebuild
Compiling ClojureScript...
Compiling "app/dev/js/main.js" from ["src"]...
WARNING: Use of undeclared Var devtools.formatters.core/header-api-call at line 112 app/dev/js/out_main/day8/re_frame_10x/view/components.cljs
WARNING: Use of undeclared Var devtools.formatters.core/body-api-call at line 115 app/dev/js/out_main/day8/re_frame_10x/view/components.cljs
WARNING: Use of undeclared Var devtools.formatters.core/has-body-api-call at line 118 app/dev/js/out_main/day8/re_frame_10x/view/components.cljs
WARNING: Use of undeclared Var re-frame.subs/kind at line 26 app/dev/js/out_main/day8/re_frame_10x/view/parts.cljs
WARNING: Use of undeclared Var re-frame.fx/kind at line 28 app/dev/js/out_main/day8/re_frame_10x/view/parts.cljs
WARNING: Use of undeclared Var re-frame.cofx/kind at line 30 app/dev/js/out_main/day8/re_frame_10x/view/parts.cljs
Successfully compiled "app/dev/js/main.js" in 28.472 seconds.
#+END_SRC
Get this error message when trying to start electron:
#+BEGIN_SRC shell
(master) working: ./electron/Electron.app/Contents/MacOS/Electron app/dev
App threw an error during load
ReferenceError: document is not defined
    at day8$re_frame_10x$inject_devtools_BANG_ (/Users/iain/Code/Clojure/Descjop/working/app/dev/js/out_main/day8/re_frame_10x.js:435:56)
    at Object.<anonymous> (/Users/iain/Code/Clojure/Descjop/working/app/dev/js/out_main/day8/re_frame_10x/preload.js:12:41)
    at Object.<anonymous> (/Users/iain/Code/Clojure/Descjop/working/app/dev/js/out_main/day8/re_frame_10x/preload.js:16:3)
    at Module._compile (module.js:569:30)
    at Object.Module._extensions..js (module.js:580:10)
    at Module.load (module.js:503:32)
    at tryModuleLoad (module.js:466:12)
    at Function.Module._load (module.js:458:3)
    at Module.require (module.js:513:17)
    at require (internal/module.js:11:18)

#+END_SRC
Updating to re-frame-10x 0.2.1-SNAPSHOT gets reid of the warnings but not the errors on electron startup.

* Bugs
** DONE Why don't year month project and version appear in the details?
   CLOSED: [2018-06-19 Tue 20:30]
** TODO [#F] Switching back to grid view doesn't call scrollIntoview
** DONE Wrong keybindings when details panel is active
    CLOSED: [2018-06-08 Fri 09:46]
** DONE on-click to select a picture and then the pics don't highlight
 although keys are correctly changed. Maybe panel-focus is not set?
    CLOSED: [2018-06-10 Sun 23:42]

** DONE Tab not sending textfield contents.
    CLOSED: [2018-06-11 Mon 23:28]
Click on textfield then hit tab. Correctly moves focus back to the picture but doesn't send the contents of the textfield so keys are not released. Maybe a blur is required. Will probably need to implement a list to track which textfield is focused first.

** DONE Pictures are not always in the correct order.
   CLOSED: [2018-07-06 Fri 01:55]
Check 1991/11/fire_and_ice for an example.
** DONE updating IPTC doesn't refresh db contents
   CLOSED: [2018-06-16 Sat 23:36]
Changes are written to the database, but the local db doesn't see them until after a refresh. Could sort this by writting the change to the db as well as calling the api, or perhaps have one trigger the other. Or most likely just fetch the pictures again.
** TODO [#G] Add keyword in keywording/panel doesn't clear when triggered
** DONE Picture keys should work when details panel is displayed.
   CLOSED: [2018-06-29 Fri 20:30]
** DONE Error message is not visible.
   CLOSED: [2018-06-22 Fri 13:45]
** DONE U key only works when keywording has focus.
   CLOSED: [2018-06-22 Fri 14:38]
** DONE Possible to add multiple identical keywords to keywording set.
   CLOSED: [2018-06-22 Fri 13:36]
** TODO [#F] Preserve order amongst keywords. New ones should be added to the end
** TODO [#D] Attempts to write IPTC fields to the API even when empty.
** DONE picture not highlighted when keywording
   CLOSED: [2018-06-24 Sun 00:15]
Picture keys work, but there is no way of telling which is current. Pic should be highlighted in grey.
** DONE keyword-set has a nil in it when there is a pic with no keywords.
   CLOSED: [2018-07-04 Wed 00:17]
** DONE Keyword buttons out of order if there are more than 10
   CLOSED: [2018-07-04 Wed 14:36]
** TODO [#D] Edit key doesn't always work without switching panel focus.
* Improvements
** Filters
*** TODO [#F] Filter by stars
*** TODO [#F] Filter by colour label.

** Keywords
already displayed in the pictures panel
*** TODO [#D] Display keyword heirarchy
*** TODO [#E] Display all pictures containing a given keyword
*** DONE Add and remove keywords from pictures
    CLOSED: [2018-06-22 Fri 13:47]
Already done for individual pics, but need to be able to do all selected pics at once. Addin works now but still need to be able to delete keyword from multiple pics.
*** DONE Add shortcut key for used-keywords
    CLOSED: [2018-06-22 Fri 01:56]
*** DONE Add storage for favorite keywords
    CLOSED: [2018-06-23 Sat 23:51]
*** DONE Add shortcut key for favorite keywords
    CLOSED: [2018-06-23 Sat 23:52]
*** DONE Store a set of keywords as favorite
    CLOSED: [2018-06-28 Thu 00:35]
** TODO [#G] Make api consistent
Parameter ordering is different when adding keywords and iptc data
** TODO [#F] Make sure that helpers/path->id is getting used.
Pretty sure it's defined inline in several places.
** TODO [#I] Clean up the way panels are selected and keysets changed.
 There may be some redundancy in that I probably shouldn't have to change panel-focus and key-set independantly. Partially sorted. Don't need to toggle focus except when projects are in view. Still need to improve it so I CAN'T toggle focus except when projects are in view.
** TODO [#D] Change tree nav controls
so left goes up on 1st press then closes on 2nd press. Also make right switch to the right panel if the highlighted tree entry is a leaf.
** TODO [#G] Remove dependancy on css to colour the selected tree item.
One possible solution is to have calls to subscriptions that are defined outside of tree.cljs. Idealy these would be conditional so that it would still work independantly of any external code.
** DONE Open a list of pictures.
   CLOSED: [2018-06-29 Fri 17:14]
** DONE Show image in right panel
   CLOSED: [2018-06-02 Sat 18:33]
Not perfect, a border round the pic would be nice.
** DONE Display pic details in left panel
   CLOSED: [2018-06-08 Fri 09:48]
** TODO [#C] Search tree for a project
** TODO [#C] Open all intermediate nodes to a specified project
** TODO [#C] Remember last viewed project
** TODO [#F] Make tabs to select the different views in the left panel.
** DONE Consider refreshing pictures
   CLOSED: [2018-06-22 Fri 13:28]
Might be a better way to go than updating them locally as well as via the api. Pictures now refresh when multiple keywords are added.
** TODO [#F] Refactor to make use of :refresh-pictures
instead of storing changes directly to db
** DONE Add delete multiple keywords functionality
   CLOSED: [2018-06-22 Fri 22:04]
** DONE Need to be able to delete keywording buttons
   CLOSED: [2018-06-26 Tue 16:33]
** DONE Add key shortcuts for keywording buttons
   CLOSED: [2018-06-28 Thu 00:18]
** TODO [#H] Add bulk editing of IPTC fields
** TODO [#I] find out how to style the box around a button.
It's generated automatically and only seems to allow the button to expand to full width when it's contained in an otherwise spurious v-box
** TODO [#G] re-write open-files. Shouldn't assume .jpg.
** TODO [#E] Show some keywords on startup.
** DONE Write keyword sets to permanent storage. Prefs too.
   CLOSED: [2018-07-06 Fri 20:46]
